{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$ref": "#/definitions/ISwarmMessageChannelDescriptionRawVersion1",
  "definitions": {
    "GUID": {
      "type": "string",
      "$comment": "GUID random - uuidv4",
      "pattern": "^[{]?[0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12}[}]?$"
    },
    "ISwarmMessageChannelDescriptionRawVersion1": {
      "type": "object",
      "properties": {
        "id": {
          "$ref": "#/definitions/TSwarmMessagesChannelId"
        },
        "version": {
          "const": "1"
        },
        "name": {
          "type": "string",
          "maxLength": 500,
          "minLength": 6
        },
        "description": {
          "type": "string",
          "maxLength": 1000,
          "minLength": 10
        },
        "tags": {
          "$ref": "#/definitions/SwarmChannelTagsList"
        },
        "dbType": {
          "$ref": "#/definitions/ESwarmStoreConnectorDatabaseType"
        },
        "dbOptions": {
          "$ref": "#/definitions/SwarmDatabaseOptions"
        },
        "messageEncryption": {
          "$ref": "#/definitions/SwarmMessagesChannelEncryptionType"
        },
        "admins": {
          "type": "array",
          "minItems": 1,
          "maxItems": 20,
          "items": {
            "$ref": "#/definitions/TSwarmMessageUserIdentifierSerialized"
          }
        }
      },
      "required": ["id", "version", "name", "description", "tags", "dbType", "dbOptions", "messageEncryption", "admins"],
      "additionalProperties": false
    },
    "TSwarmMessagesChannelId": {
      "ref": "#/definitions/GUID"
    },
    "ESwarmStoreConnectorDatabaseType": {
      "type": "string",
      "enum": ["feed_store", "key_value"]
    },
    "SwarmMessagesChannelEncryptionType": {
      "type": "string",
      "enum": ["PUBLIC", "PRIVATE", "PASSWORD"]
    },
    "TSwarmMessageUserIdentifierSerialized": {
      "type": "string",
      "maxLength": 100,
      "minLength": 10
    },
    "SwarmChannelTag": {
      "type": "string",
      "pattern": "^\\w{3,15}$"
    },
    "SwarmChannelTagsList": {
      "type": "array",
      "minItems": 1,
      "maxItems": 20,
      "items": {
        "$ref": "#/definitions/SwarmChannelTag"
      }
    },
    "SwarmDatabaseOptionsGrantAccessCallback": {
      "$comment": "Function which is used for write access. 'instanceof' - is a custom keyword",
      "instanceof": "Function"
    },
    "SwarmDatabaseOptionsWriteAccessUsersIdentities": {
      "type": "array",
      "minItems": 1,
      "maxItems": 100,
      "items": {
        "$ref": "#/definitions/TSwarmMessageUserIdentifierSerialized"
      }
    },
    "SwarmDatabaseOptions": {
      "oneOf": [
        {
          "type": "object",
          "$comment": "If public channel",
          "properties": {
            "isPublic": {
              "const": "true"
            },
            "grantAccess": {
              "$ref": "#/definitions/SwarmDatabaseOptionsGrantAccessCallback"
            }
          },
          "required": ["isPublic"],
          "additionalProperties": false
        },
        {
          "type": "object",
          "$comment": "If a private channel only for the few users with write access",
          "properties": {
            "isPublic": {
              "const": "false"
            },
            "write": {
              "$ref": "#/definitions/SwarmDatabaseOptionsWriteAccessUsersIdentities"
            },
            "grantAccess": {
              "$ref": "#/definitions/SwarmDatabaseOptionsGrantAccessCallback"
            }
          },
          "required": ["write"],
          "additionalProperties": false
        },
        {
          "type": "object",
          "$comment": "The write access is fully controled by the grant access callback",
          "properties": {
            "isPublic": {
              "const": "false"
            },
            "grantAccess": {
              "$ref": "#/definitions/SwarmDatabaseOptionsGrantAccessCallback"
            }
          },
          "required": ["grantAccess"],
          "additionalProperties": false
        }
      ]
    }
  }
}
